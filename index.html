<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="style.css" />
    <title>Scanner reader</title>
    <script
      src="https://unpkg.com/html5-qrcode"
      type="text/javascript"
    ></script>
    <!-- <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script> -->
  </head>

  <body>
    <div class="app">
      <div id="reader"></div>
      <div id="ratio"></div>
    </div>
  </body>

  <script>
    let scannedProducts = new Set();
    let count = 0;

    const config = {
      fps: 60,
      // qrbox: { width: 320, height: 240 },
      qrbox: { width: 320, height: 280 },
      aspectRatio: window.innerWidth / window.innerHeight,
      formatsToSupport: [Html5QrcodeSupportedFormats.DATA_MATRIX],
    };

    const html5Qrcode = new Html5Qrcode("reader");

    function onScanSuccess(text, result) {
      if (
        !scannedProducts.current.has(decodedText) &&
        result.format.formatName === "DATA_MATRIX"
      ) {
        scannedProducts.push(result);
      } else {
        console.log("Дубликат, не добавляем:", result);
      }

      console.log("Scanned:", text);
      console.log("Array:", scannedProducts);
    }

    function onScanError(err) {
      console.warn("ERROR:", err);
    }

    Html5Qrcode.getCameras().then((cameras) => {
      if (!cameras || cameras.length === 0) {
        console.error("No cameras found");
        return;
      }
      if (!cameras.length) return;

      const cameraId = cameras[0].id;

      html5Qrcode.start(
        { deviceId: cameraId },
        config,
        onScanSuccess,
        onScanError,
      );
    });
  </script>
</html>
